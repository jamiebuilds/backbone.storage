!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("backbone"),require("backbone-metal")):"function"==typeof define&&define.amd?define(["backbone","backbone-metal"],b):a.Backbone.Storage=b(a.Backbone,a.Metal)}(this,function(a,b){"use strict";var c=a.Storage=b.Class.extend({model:a.Model,collection:a.Collection,constructor:function(){var a=this;this.records=new this.collection,this.listenToOnce(this.records,"sync",function(){a._hasSynced=!0}),this._super.apply(this,arguments)},find:function(a){var b=this,c=void 0===arguments[1]?!1:arguments[1],d=this.records.get(a);return d&&!c?Promise.resolve(d):(a=this._ensureModel(a),Promise.resolve(a.fetch()).then(function(){return b.insert(a)}))},findAll:function(){var a=this,b=void 0===arguments[0]?{}:arguments[0],c=void 0===arguments[1]?!1:arguments[1];return this._hasSynced&&!c?Promise.resolve(this.records):Promise.resolve(this.records.fetch(b)).then(function(){return a.records})},save:function(a){var b=this,c=this.records.get(a);return a=c||this._ensureModel(a),Promise.resolve(a.save()).then(function(){return c||b.insert(a),a})},insert:function(a){return a=this.records.add(a,{merge:!0}),Promise.resolve(a)},_ensureModel:function(a){return a instanceof this.model?a:"object"==typeof a?new this.model(a):new this.model({id:a})}}),d=c;return d});
//# sourceMappingURL=backbone.storage.min.js.map